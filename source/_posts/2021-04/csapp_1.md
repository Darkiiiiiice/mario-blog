---
title: 深入理解计算机系统（一） 
date: '2021-04-11 20:00:00'
category: CS
author: MarioMang
cover: /resources/images/default_cover.gif
updated: '2021-04-11 20:00:00'
---

## 计算机系统漫游

### 信息就是位 + 上下文

系统中所有的信息--包括磁盘文件， 内存中的程序，内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。区分不同数据对象的唯一方法就是我们读到这些数据对象时的上下文

### 程序被其他程序翻译程不同格式

hello.c --> 预处理阶段 --> hello.i --> 编译器 --> hello.s --> 汇编器 --> hello.o --> 链接器 --> hello

执行上述四个阶段的程序一起构成了编译系统

### 处理器读并解释存储在内存中的指令

#### 系统的硬件组成

1. 总线

贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件间传递。
总线通常被设计成传送定长的字节块，也就是字(word)。字长是一个基本的系统参数

2. I/O设备

I/O设备是系统与外部世界的联系通道，每个I/O设备都通过一个控制器或适配器与I/O总线相连
控制器是I/O设备本身或者系统的主印刷电路板(通常称作主板)上的芯片组
适配器则是一块插在主板插槽上的卡

3. 主存

主存是一块临时存储设备, 在处理器执行程序时，用来存放程序和程序处理的数据
从物理上来说，主存时一组动态随机存取存储器(DRAM)芯片组成的
从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址，这些地址是从零开始的

4. 处理器

中央处理单元(CPU)， 简称处理器， 是解释存储在主存中指令的引擎
处理器的核心是一个大小为一个字的存储设备，称为程序计数器(PC)，在任何时候PC都指向主存中的某条机器语言指令

寄存器文件是一个小的存储设备， 由一些单个字长的寄存器组成，每个寄存器都有唯一的名字

CPU在指令的要求下可能会执行下面的操作

* 加载: 从主存复制一个字节或者一个字到寄存器， 以覆盖寄存器原来的内容
* 存储: 从寄存器复制一个字节或者一个字到主存的某个位置, 以覆盖这个位置上原来的内容
* 操作: 把两个寄存器的内容复制到ALU，ALU对这两个字做算数运算，并将结果存放到一个寄存器中, 以覆盖该寄存器原来的内容
* 跳转: 从指令本身抽取一个字，并将这个字复制到程序计数器PC中, 以覆盖PC中原来的值

### 高速缓存

针对处理器与主存之间的差异，系统设计了更小更快的存储设备，称为高速缓存存储器，作为暂时的集结区域

L1和L2高速缓存是用一种叫做静态随机访问存储器(SRAM)的硬件技术实现的

### 操作系统管理硬件

操作系统有两个基本功能

1. 防止硬件被失控的应用程序滥用
2. 向应用程序提供简单一致的机制来控制复杂而又不相同的低级硬件设备

#### 进程

进程是操作系统对一个正在运行的程序的一种抽象。
操作系统保持跟踪进程运行所需的所有状态信息，这种状态，也就是上下文。
当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换

#### 线程

一个进程实际上可以由多个线程执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据

#### 虚拟内存

虚拟内存是一个抽象概念，它为每个进程提供一个假象，即每个进程都在独占地使用主存, 每个内存看到的内存都是一致的，称为虚拟地址空间

从最低的地址开始

* 程序代码和数据  对所有进程来说，代码是从同一固定地址开始
* 堆  运行时堆，可以在运行时动态的扩展和收缩
* 共享库  用来存放共享库的代码和数据区域
* 栈  位于用户虚拟地址空间顶部的是用户栈, 编译器用它来实现函数调用
* 内核虚拟内存  地址空间顶部的区域是为内核保留的

#### 文件

文件就是字节序列, 每个I/O设备，都可以看成是文件，系统中的所有输入输出都是通过使用一组称为Unix I/O的系统函数调用读写文件来实现的

### 重要主题

#### Amdahl定律

当我们对系统的某个部分加速时, 其对系统整体性能的影响取决于该部分的重要性和加速程度

Tnew =  (1-a)Told + (aTold)/k = Told[(1-a) a/k]

S = Told / Tnew ===> S= 1 / (1-a) + a/k

#### 并发和并行

1. 线程级并发
2. 指令级并行
3. 单指令/多数据并行




